#! /usr/bin/env bash
# @VERSION 1.0.0
# @AUTHOR Hasnae R.
# @LICENSE Apache-2.0

source selfedit.sh

DOCKER_IMAGES_HOME=${VIQUEEN_DEVBOX_HOME}/docker-images

_image() {
    _with_arguments 2 $@
    name=${1}
    version=${2}
    echo "viqueen/${1}:${version}"
}

# @COMMAND build [name] [tag]       builds a docker image in viqueen namespace
function build() {
    image=$(_image $@)
    target=${DOCKER_IMAGES_HOME}/${1}/
    sed "s/\${JDK_VERSION}/${2}/g" ${target}/jdk.Dockerfile > ${target}/Dockerfile

    shift
    shift

    docker build -t ${image} ${target}/ $@
}

# @COMMAND push [name] [tag]        pushes a docker image to viqueen namespace on docker hub
function push() {
    image=$(_image $@)
    shift
    shift
    docker push ${image} $@
}

# @COMMAND run [name] [tag]         runs a docker image from viqueen namespace
function run() {
    image=$(_image $@)
    docker run -it --entrypoint=/bin/bash ${image}
}

eval $@
